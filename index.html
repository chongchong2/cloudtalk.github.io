<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CloudTalk — CloudKit 기반 비공개 채팅</title>
  <meta name="description" content="CloudTalk는 Apple CloudKit을 활용해 iCloud에 안전하게 저장되는 비공개 채팅을 제공합니다. 공유 채팅방은 CloudKit 공유 기능으로 협업이 가능합니다." />
  <meta property="og:title" content="CloudTalk — CloudKit 기반 비공개 채팅" />
  <meta property="og:description" content="CloudTalk는 Apple CloudKit을 활용해 iCloud에 안전하게 저장되는 비공개 채팅을 제공합니다." />
  <meta property="og:type" content="website" />
  <meta property="og:locale" content="ko_KR" />
  <meta name="theme-color" content="#0b6bff" />
  <style>
    :root{
      --bg:#0b0d11; --panel:#10131a; --muted:#9aa4b2; --text:#e9eef5; --brand:#0b6bff;
      --accent:#6aa4ff; --ok:#15b887; --warn:#ffb020; --radius:16px; --shadow:0 8px 28px rgba(0,0,0,.35);
    }
    @media (prefers-color-scheme: light){
      :root{ --bg:#f7f9fc; --panel:#ffffff; --muted:#5a6b7e; --text:#0c1220; --brand:#0b6bff; --accent:#4e89ff; }
      .hero{ background: radial-gradient(1200px 600px at 20% 10%, #e9f1ff 0, transparent 60%),
                 radial-gradient(900px 500px at 80% 0, #f0f7ff 0, transparent 60%), linear-gradient(180deg,#ffffff, #f7f9fc);}
      header{ background: rgba(255,255,255,.75); backdrop-filter: blur(8px); }
    }
    *{ box-sizing:border-box }
    html,body{ margin:0; padding:0; background:var(--bg); color:var(--text); font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Apple SD Gothic Neo", "Noto Sans KR", sans-serif; }
    a{ color:inherit; text-decoration:none }
    .container{ max-width:1100px; margin:0 auto; padding:0 20px }
    header{
      position:sticky; top:0; z-index:50; border-bottom:1px solid rgba(255,255,255,.06);
      background: rgba(16,19,26,.65); backdrop-filter: blur(10px);
    }
    nav{ display:flex; align-items:center; justify-content:space-between; height:64px }
    .brand{ display:flex; gap:12px; align-items:center; font-weight:700 }
    .logo{ width:28px; height:28px; border-radius:8px; background:linear-gradient(135deg, var(--brand), var(--accent)); box-shadow: inset 0 0 0 1px rgba(255,255,255,.25) }
    .nav-links{ display:flex; gap:18px; font-size:14px; color:var(--muted) }
    .nav-links a:hover{ color:var(--text) }
    .btn{ display:inline-flex; align-items:center; gap:8px; height:44px; padding:0 16px; border-radius:12px; border:1px solid rgba(255,255,255,.12); background:transparent; color:var(--text); cursor:pointer }
    .btn.primary{ background: linear-gradient(135deg, var(--brand), var(--accent)); border:none; color:#fff; box-shadow: var(--shadow) }
    .btn.ghost{ background: transparent }
    .hero{ padding:96px 0 64px; position:relative; overflow:hidden }
    .hero h1{ font-size:42px; line-height:1.15; margin:0 0 16px }
    .hero p{ color:var(--muted); font-size:18px; margin:0 0 28px }
    .hero-cta{ display:flex; gap:12px; flex-wrap:wrap }
    .grid{ display:grid; gap:20px }
    .cards{ grid-template-columns: repeat(12, 1fr) }
    .card{
      grid-column: span 6; background:var(--panel); border:1px solid rgba(255,255,255,.08); border-radius:var(--radius);
      padding:20px; box-shadow:var(--shadow); transition: transform .2s ease, box-shadow .2s ease
    }
    .card:hover{ transform: translateY(-2px) }
    .kicker{ font-size:12px; letter-spacing:.12em; text-transform:uppercase; color:var(--muted); margin-bottom:8px }
    h2{ margin:56px 0 18px; font-size:28px }
    section{ padding:28px 0 }
    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; font-size:13px; color:#cfe4ff }
    pre{ margin:0; padding:16px; border-radius:12px; background:#0b0d11; border:1px solid rgba(255,255,255,.08); overflow:auto }
    .muted{ color:var(--muted) }
    .pill{ display:inline-block; font-size:12px; padding:4px 10px; border-radius:999px; background:rgba(11,107,255,.12); color:#9ec4ff; border:1px solid rgba(11,107,255,.25) }
    .twocol{ display:grid; grid-template-columns: 1.1fr .9fr; gap:24px }
    .diagram{ background:var(--panel); border:1px solid rgba(255,255,255,.08); border-radius:var(--radius); padding:16px; overflow:hidden }
    .diagram svg{ width:100%; height:auto; display:block }
    details{ background:var(--panel); border:1px solid rgba(255,255,255,.08); border-radius:12px; padding:14px 16px }
    details + details{ margin-top:12px }
    summary{ cursor:pointer; font-weight:600 }
    footer{ margin-top:64px; padding:32px 0 56px; color:var(--muted); border-top:1px solid rgba(255,255,255,.08) }
    /* responsive */
    @media (max-width: 920px){
      .card{ grid-column: span 12 }
      .twocol{ grid-template-columns: 1fr }
      .hero h1{ font-size:34px }
    }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <nav>
        <div class="brand">
          <div class="logo" aria-hidden="true"></div>
          <a href="#top" aria-label="CloudTalk 홈">CloudTalk</a>
        </div>
        <div class="nav-links">
          <a href="#overview">개요</a>
          <a href="#features">특징</a>
          <a href="#architecture">아키텍처</a>
          <a href="#records">레코드 유형</a>
          <a href="#workflows">워크플로우</a>
          <a href="#faq">FAQ</a>
        </div>
        <div style="display:flex; gap:8px">
          <a class="btn ghost" href="#" aria-label="TestFlight">TestFlight</a>
          <a class="btn primary" href="#" aria-label="App Store">App Store</a>
        </div>
      </nav>
    </div>
  </header>

  <main id="top">
    <!-- Hero -->
    <section class="hero">
      <div class="container">
        <span class="pill">CloudKit 기반</span>
        <h1>iCloud에 안전하게 저장되는<br/>비공개 채팅, <span style="background:linear-gradient(135deg,var(--brand),var(--accent)); -webkit-background-clip:text; background-clip:text; color:transparent">CloudTalk</span></h1>
        <p>CloudTalk는 Apple의 CloudKit을 활용하여 강력하고 안전한 비공개 통신을 제공합니다. 공유 채팅방은 CloudKit 공유 기능으로 참여자 간 협업이 가능합니다.</p>
        <div class="hero-cta">
          <a class="btn primary" href="#" aria-label="App Store 바로가기">App Store</a>
          <a class="btn" href="#overview">자세히 보기</a>
        </div>
      </div>
    </section>

    <!-- Overview & Features -->
    <section id="overview">
      <div class="container">
        <h2>개요</h2>
        <p class="muted">CloudTalk는 Apple의 CloudKit 프레임워크를 활용하여 비공개 iCloud 계정에 안전하게 데이터가 저장되는 채팅 애플리케이션입니다. 사용자는 채팅방을 만들고, 다른 사람을 초대하고, 메시지를 교환할 수 있습니다. 공유 채팅방은 CloudKit의 공유 기능을 통해 협업이 가능합니다.</p>

        <section id="features">
          <h2>핵심 기능</h2>
          <div class="grid cards">
            <div class="card">
              <div class="kicker">Privacy</div>
              <h3 style="margin:4px 0 10px">비공개 iCloud 저장</h3>
              <p class="muted">모든 채팅 메시지와 메타데이터는 각 사용자의 비공개 iCloud 데이터베이스에 저장됩니다.</p>
            </div>
            <div class="card">
              <div class="kicker">Sharing</div>
              <h3 style="margin:4px 0 10px">CloudKit 공유</h3>
              <p class="muted">채팅방 단위로 사용자 정의 존(zone)을 공유하고, 초대 링크(CloudKit <span class="mono">CKShare</span>)로 손쉽게 참여할 수 있습니다.</p>
            </div>
            <div class="card">
              <div class="kicker">Realtime</div>
              <h3 style="margin:4px 0 10px">변경 알림</h3>
              <p class="muted">사용자 정의 <span class="mono">CKRecordZoneSubscription</span>으로 새로운 메시지 등 변경 사항을 푸시로 받아 즉시 동기화합니다.</p>
            </div>
            <div class="card">
              <div class="kicker">Isolation</div>
              <h3 style="margin:4px 0 10px">존별 데이터 격리</h3>
              <p class="muted">채팅방마다 별도의 <span class="mono">CKRecordZone</span>을 사용하여 데이터가 안전하게 구분됩니다.</p>
            </div>
          </div>
        </section>
      </div>
    </section>

    <!-- Architecture -->
    <section id="architecture">
      <div class="container">
        <h2>CloudKit 아키텍처</h2>
        <div class="twocol">
          <div>
            <p class="muted">백엔드는 전적으로 CloudKit으로 구성됩니다. 공개/비공개 데이터베이스와 사용자 정의 레코드 존을 활용하여 데이터 격리와 관리를 수행합니다.</p>
            <ul class="muted">
              <li>비공개 데이터베이스(Private DB): 개인 데이터 저장</li>
              <li>공개 데이터베이스(Public DB): 닉네임 등 식별용 공개 정보</li>
              <li>공유 데이터베이스(Shared DB): 초대로 접근하는 공유 채팅 데이터</li>
            </ul>
          </div>
          <div class="diagram" aria-label="CloudKit Architecture Diagram">
            <!-- Simple inline SVG diagram -->
            <svg viewBox="0 0 800 360" role="img">
              <defs>
                <linearGradient id="g1" x1="0" x2="1">
                  <stop offset="0" stop-color="#0b6bff"/>
                  <stop offset="1" stop-color="#6aa4ff"/>
                </linearGradient>
              </defs>
              <rect x="0" y="0" width="800" height="360" fill="none"/>
              <!-- Client App -->
              <rect x="24" y="36" width="200" height="96" rx="14" fill="#141a23" stroke="#2b3340"/>
              <text x="124" y="74" fill="#cfe4ff" text-anchor="middle" font-size="16" font-family="ui-monospace">CloudTalk iOS</text>
              <text x="124" y="101" fill="#9aa4b2" text-anchor="middle" font-size="12">앱</text>

              <!-- Private DB -->
              <rect x="300" y="24" width="200" height="96" rx="14" fill="#141a23" stroke="#2b3340"/>
              <text x="400" y="62" fill="#cfe4ff" text-anchor="middle" font-size="16" font-family="ui-monospace">Private DB</text>
              <text x="400" y="86" fill="#9aa4b2" text-anchor="middle" font-size="12">개인 데이터</text>

              <!-- Public DB -->
              <rect x="300" y="132" width="200" height="96" rx="14" fill="#141a23" stroke="#2b3340"/>
              <text x="400" y="170" fill="#cfe4ff" text-anchor="middle" font-size="16" font-family="ui-monospace">Public DB</text>
              <text x="400" y="194" fill="#9aa4b2" text-anchor="middle" font-size="12">닉네임 등 공개</text>

              <!-- Shared DB -->
              <rect x="300" y="240" width="200" height="96" rx="14" fill="#141a23" stroke="#2b3340"/>
              <text x="400" y="278" fill="#cfe4ff" text-anchor="middle" font-size="16" font-family="ui-monospace">Shared DB</text>
              <text x="400" y="302" fill="#9aa4b2" text-anchor="middle" font-size="12">초대/참여 데이터</text>

              <!-- Arrows -->
              <path d="M224,84 L292,72" stroke="url(#g1)" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
              <path d="M224,84 L292,180" stroke="url(#g1)" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
              <path d="M224,84 L292,288" stroke="url(#g1)" stroke-width="2" fill="none" marker-end="url(#arrow)"/>

              <!-- Zone boxes -->
              <rect x="520" y="24" width="256" height="312" rx="14" fill="#11161f" stroke="#2b3340"/>
              <text x="648" y="54" fill="#9aa4b2" text-anchor="middle" font-size="12">예: 채팅방 전용 CKRecordZone</text>

              <rect x="540" y="80" width="216" height="80" rx="12" fill="#141a23" stroke="#2b3340"/>
              <text x="648" y="112" fill="#cfe4ff" text-anchor="middle" font-size="14">ChatRoomInfo</text>
              <text x="648" y="132" fill="#9aa4b2" text-anchor="middle" font-size="12">roomName / zoneName / userlist</text>

              <rect x="540" y="176" width="216" height="80" rx="12" fill="#141a23" stroke="#2b3340"/>
              <text x="648" y="208" fill="#cfe4ff" text-anchor="middle" font-size="14">Message</text>
              <text x="648" y="228" fill="#9aa4b2" text-anchor="middle" font-size="12">content / sender / timestamp / media</text>

              <defs>
                <marker id="arrow" markerWidth="10" markerHeight="10" refX="6" refY="3" orient="auto" markerUnits="strokeWidth">
                  <path d="M0,0 L6,3 L0,6 Z" fill="#6aa4ff"/>
                </marker>
              </defs>
            </svg>
          </div>
        </div>
      </div>
    </section>

    <!-- Record Types -->
    <section id="records">
      <div class="container">
        <h2>레코드 유형</h2>
        <div class="grid cards">
          <div class="card">
            <h3>AppUser <span class="kicker">Private DB</span></h3>
            <p class="muted">애플리케이션 사용자의 필수 정보를 비공개 데이터베이스에 저장합니다.</p>
            <pre><code class="mono">userId: String
ownerName: String
nickName: String</code></pre>
          </div>
          <div class="card">
            <h3>User <span class="kicker">Public DB</span></h3>
            <p class="muted"><span class="mono">AppUser</span>의 일부(주로 <span class="mono">nickName</span>)를 공개 DB에 미러링하여 공유 채팅에서 식별 가능하게 합니다.</p>
            <pre><code class="mono">recordName (== userId)
nickName: String</code></pre>
          </div>
          <div class="card">
            <h3>ChatRoomInfo <span class="kicker">Zone</span></h3>
            <p class="muted">채팅방 메타데이터. 각 채팅방은 자체 <span class="mono">CKRecordZone</span>에 존재합니다.</p>
            <pre><code class="mono">roomName: String
zoneName: String
userlist: [String]  // userId 배열</code></pre>
          </div>
          <div class="card">
            <h3>Message <span class="kicker">Zone</span></h3>
            <p class="muted">단일 채팅 메시지. 미디어 첨부는 <span class="mono">CKAsset</span> 배열로 저장될 수 있습니다.</p>
            <pre><code class="mono">content: String
sender: String       // userId
timestamp: Date
mediaArray: [CKAsset]?
mediaTypes: [String]?
chatRoomInfoRef: CKRecord.Reference</code></pre>
          </div>
          <div class="card">
            <h3>ChatRoomList <span class="kicker">Private DB</span></h3>
            <p class="muted">초기 설계에서는 채팅방 목록을 유지하기 위한 타입이었으나, 현재는 사용자 정의 존의 <span class="mono">ChatRoomInfo</span> 쿼리로 대체됩니다.</p>
            <pre><code class="mono">// 현재 구현에서는 미사용(대체됨)</code></pre>
          </div>
        </div>
      </div>
    </section>

    <!-- Workflows -->
    <section id="workflows">
      <div class="container">
        <h2>핵심 워크플로우</h2>

        <details open>
          <summary>1) 사용자 초기화 및 온보딩</summary>
          <ol class="muted">
            <li>앱이 iCloud 계정 상태를 확인하여 로그인 여부를 점검합니다.</li>
            <li>고유한 <span class="mono">userId</span>가 생성됩니다.</li>
            <li>비공개 DB에 <span class="mono">AppUser(userId, ownerName, nickName)</span> 레코드를 생성합니다.</li>
            <li>공개 DB에 동일 <span class="mono">userId</span>로 <span class="mono">User</span> 레코드를 생성해 닉네임을 노출합니다.</li>
          </ol>
        </details>

        <details>
          <summary>2) 채팅방 생성</summary>
          <ol class="muted">
            <li>비공개 DB에 새로운 사용자 정의 <span class="mono">CKRecordZone</span>을 생성합니다(<span class="mono">zoneName</span>은 고유 식별자).</li>
            <li>해당 존 내부에 <span class="mono">ChatRoomInfo</span> 레코드를 만들고 <span class="mono">roomName / zoneName / userlist</span>를 설정합니다.</li>
            <li>존에 대한 <span class="mono">CKRecordZoneSubscription</span>을 생성해 변경 시 푸시 알림을 수신합니다.</li>
          </ol>
        </details>

        <details>
          <summary>3) 메시지 송수신</summary>
          <ol class="muted">
            <li>메시지 전송 시 새로운 <span class="mono">Message</span> 레코드를 생성합니다.</li>
            <li>레코드는 해당 채팅방의 사용자 정의 존에 저장됩니다.</li>
            <li><span class="mono">content / sender(userId) / timestamp</span> 및 선택적 <span class="mono">mediaArray / mediaTypes</span>를 포함합니다.</li>
            <li><span class="mono">chatRoomInfoRef</span>로 <span class="mono">ChatRoomInfo</span>와 연결합니다.</li>
            <li>저장 완료 후 구독된 기기로 푸시가 전송되고, 앱은 <span class="mono">zoneName</span>을 기반으로 새 메시지를 가져옵니다.</li>
          </ol>
        </details>

        <details>
          <summary>4) 채팅방 공유 및 참여</summary>
          <ol class="muted">
            <li>소유자가 공유를 시작하면 채팅방 존에 연결된 <span class="mono">CKShare</span>가 생성됩니다.</li>
            <li>생성된 고유 URL을 다른 사용자에게 전송합니다.</li>
            <li>수신자는 URL을 통해 <span class="mono">CKShare</span>를 수락하고 자신의 공유 DB에서 해당 존에 접근합니다.</li>
            <li>앱은 공유 DB에 대한 구독을 생성하여 업데이트 알림을 받습니다.</li>
            <li>참여 시 새 사용자의 <span class="mono">userId</span>가 공유 존의 <span class="mono">ChatRoomInfo.userlist</span>에 추가됩니다.</li>
          </ol>
        </details>
      </div>
    </section>

    <!-- FAQ -->
    <section id="faq">
      <div class="container">
        <h2>FAQ</h2>
        <details>
          <summary>CloudTalk 데이터는 어디에 저장되나요?</summary>
          <p class="muted">데이터는 사용자의 iCloud 계정 내 CloudKit 데이터베이스(비공개/공유/공개)에 저장됩니다.</p>
        </details>
        <details>
          <summary>푸시 알림은 어떻게 동작하나요?</summary>
          <p class="muted">채팅방 별 <span class="mono">CKRecordZoneSubscription</span>을 이용하여 레코드 변경 시 푸시 알림을 수신합니다.</p>
        </details>
        <details>
          <summary>공유 채팅방 초대는 어떻게 하나요?</summary>
          <p class="muted"><span class="mono">CKShare</span>를 생성하면 고유 URL이 만들어지며, 수신자가 이를 수락하면 공유 데이터베이스에서 해당 존에 접근할 수 있습니다.</p>
        </details>
      </div>
    </section>
  </main>

  <footer>
    <div class="container">
      <div style="display:flex; gap:24px; flex-wrap:wrap; align-items:center; justify-content:space-between">
        <div>© <span id="year"></span> CloudTalk. 모든 권리 보유.</div>
        <div class="muted" style="font-size:12px">iCloud, CloudKit, CKRecord 등은 Apple Inc.의 상표입니다.</div>
      </div>
    </div>
  </footer>

  <script>
    // smooth scroll for in-page anchors
    document.querySelectorAll('a[href^="#"]').forEach(a=>{
      a.addEventListener('click',e=>{
        const id=a.getAttribute('href').slice(1);
        const el=document.getElementById(id);
        if(el){ e.preventDefault(); el.scrollIntoView({behavior:'smooth', block:'start'}) }
      })
    });
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>
</body>
</html>
